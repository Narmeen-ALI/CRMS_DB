<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRMS | Tactical Map</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    body { margin: 0; background: #050510; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
    
    .map-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at center, #1a1a3a 0%, #050510 100%);
    }

    .station-label {
      position: absolute;
      background: rgba(220, 20, 60, 0.2);
      backdrop-filter: blur(10px);
      border-left: 3px solid #dc143c;
      padding: 8px 15px;
      color: white;
      font-size: 12px;
      pointer-events: none;
      border-radius: 0 5px 5px 0;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: none;
    }

    .map-controls {
      position: absolute;
      top: 100px;
      left: 30px;
      z-index: 100;
      background: rgba(10, 10, 30, 0.85);
      padding: 25px;
      border-radius: 4px;
      border: 1px solid rgba(220, 20, 60, 0.5);
      box-shadow: 0 0 30px rgba(220, 20, 60, 0.2);
      clip-path: polygon(0 0, 100% 0, 100% 90%, 90% 100%, 0 100%); /* Futuristic Cut */
    }

    .control-group select {
      background: #000;
      color: #ff6b6b;
      border: 1px solid #dc143c;
      padding: 10px;
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* HUD Elements */
    .scanner-line {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: rgba(220, 20, 60, 0.3);
      box-shadow: 0 0 15px #dc143c;
      animation: scan 4s linear infinite;
    }

    @keyframes scan {
      0% { top: 0; }
      100% { top: 100%; }
    }

    .stats-display { border-top: 1px solid #dc143c; margin-top: 15px; }
    .stat-value { color: #00f2ff; text-shadow: 0 0 10px #00f2ff; }
  </style>
</head>
<body>

<header class="site-header">
    </header>

<div class="map-container">
    <div class="scanner-line"></div>
    <div id="stationInfo" class="station-label"></div>

    <div class="map-controls">
      <h3><span style="color:#dc143c">âš¡</span> TACTICAL OVERLAY</h3>
      <div class="control-group">
        <label>Sector Deployment</label>
        <select id="citySelect">
          <option value="">SCANNING REGIONS...</option>
          <option value="karachi">KARACHI SECTOR</option>
          <option value="lahore">LAHORE SECTOR</option>
          <option value="islamabad">ISLAMABAD SECTOR</option>
        </select>
      </div>

      <div class="stats-display">
        <div class="stat-item">
          <span>Active Precincts:</span>
          <span class="stat-value" id="totalStations">0</span>
        </div>
        <div class="stat-item">
          <span>Threat Level:</span>
          <span class="stat-value" id="threatLevel">STABLE</span>
        </div>
      </div>
    </div>

    <canvas id="mapCanvas"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- SCENE SETUP ---
    let scene, camera, renderer, globe, particles;
    const canvas = document.getElementById('mapCanvas');
    const stationLabel = document.getElementById('stationInfo');

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 30;

        renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        // 1. Futuristic Grid Floor
        const grid = new THREE.GridHelper(100, 50, 0xdc143c, 0x111122);
        grid.position.y = -10;
        scene.add(grid);

        // 2. Floating Particle Atmosphere
        const pGeometry = new THREE.BufferGeometry();
        const pCount = 2000;
        const coords = [];
        for(let i=0; i<pCount; i++) {
            coords.push((Math.random()-0.5)*100, (Math.random()-0.5)*100, (Math.random()-0.5)*100);
        }
        pGeometry.setAttribute('position', new THREE.Float32BufferAttribute(coords, 3));
        const pMaterial = new THREE.PointsMaterial({ color: 0xdc143c, size: 0.1, transparent: true, opacity: 0.5 });
        particles = new THREE.Points(pGeometry, pMaterial);
        scene.add(particles);

        // 3. Central Holographic Hub
        const hubGeom = new THREE.IcosahedronGeometry(5, 1);
        const hubMat = new THREE.MeshBasicMaterial({ color: 0xdc143c, wireframe: true, transparent: true, opacity: 0.2 });
        globe = new THREE.Mesh(hubGeom, hubMat);
        scene.add(globe);

        addLights();
        animate();
    }

    function addLights() {
        const light = new THREE.PointLight(0xdc143c, 2, 100);
        light.position.set(10, 10, 10);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040, 2));
    }

    // --- INTERACTIVE MARKERS ---
    const markers = [];
    function createTacticalMarker(data, index) {
        const group = new THREE.Group();
        
        // The Floating Crystal
        const geom = new THREE.OctahedronGeometry(0.8);
        const mat = new THREE.MeshPhongMaterial({ 
            color: 0x00f2ff, 
            emissive: 0x00f2ff, 
            transparent: true, 
            opacity: 0.8,
            flatShading: true 
        });
        const mesh = new THREE.Mesh(geom, mat);
        
        // Floating animation
        gsap.to(mesh.position, { y: 1, duration: 1.5 + Math.random(), repeat: -1, yoyo: true, ease: "sine.inOut" });
        gsap.to(mesh.rotation, { y: Math.PI, duration: 3, repeat: -1, ease: "none" });

        // Radar Circle
        const ringGeom = new THREE.RingGeometry(1.2, 1.4, 32);
        const ringMat = new THREE.MeshBasicMaterial({ color: 0xdc143c, transparent: true, opacity: 0.4, side: THREE.DoubleSide });
        const ring = new THREE.Mesh(ringGeom, ringMat);
        ring.rotation.x = Math.PI/2;

        group.add(mesh, ring);
        
        // Position on grid
        const angle = (index / 8) * Math.PI * 2;
        group.position.set(Math.cos(angle)*15, -9, Math.sin(angle)*15);
        
        group.userData = data;
        scene.add(group);
        markers.push(group);
    }

    // --- SELECTION LOGIC ---
    document.getElementById('citySelect').addEventListener('change', (e) => {
        const city = e.target.value;
        if(!city) return;

        // Clear old
        markers.forEach(m => scene.remove(m));
        markers.length = 0;

        document.getElementById('threatLevel').textContent = city === 'karachi' ? 'HIGH' : 'ELEVATED';
        document.getElementById('threatLevel').style.color = city === 'karachi' ? '#ff0000' : '#ffaa00';

        for(let i=0; i<6; i++) {
            createTacticalMarker({ name: `STATION-ALPHA-${i+1}`, cases: Math.floor(Math.random()*50) }, i);
        }
        document.getElementById('totalStations').textContent = "6 UNITS";

        gsap.to(camera.position, { z: 45, y: 20, duration: 1.5, ease: "power2.out" });
    });

    function animate() {
        requestAnimationFrame(animate);
        globe.rotation.y += 0.005;
        particles.rotation.y += 0.001;
      
        camera.position.x += (mouseX - camera.position.x) * 0.05;
        camera.lookAt(0,0,0);
        
        renderer.render(scene, camera);
    }

    let mouseX = 0;
    window.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX - window.innerWidth / 2) / 100;
    });

    init();
</script>
</body>
</html>